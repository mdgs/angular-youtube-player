var youtubePlayerModule=angular.module("youtubePlayer",[]);!function(){window.base={},function(base){base.DelegateService=function(methodNames){function trueFn(){return!0}if(methodNames.indexOf("$getByHandle")>-1)throw new Error("Method '$getByHandle' is implicitly added to each delegate service. Do not list it as a method.");return["$log",function($log){function DelegateInstance(instances,handle){this._instances=instances,this.handle=handle}function DelegateService(){this._instances=[]}function instanceMethodCaller(methodName){return function(){var returnValue,handle=this.handle,args=arguments,foundInstancesCount=0;return this._instances.forEach(function(instance){if((!handle||handle===instance.$$delegateHandle)&&instance.$$filterFn(instance)){foundInstancesCount++;var ret=instance[methodName].apply(instance,args);1===foundInstancesCount&&(returnValue=ret)}}),!foundInstancesCount&&handle?$log.warn('Delegate for handle "'+handle+'" could not find a corresponding element with delegate-handle="'+handle+'"! '+methodName+"() was not called!\nPossible cause: If you are calling "+methodName+'() immediately, and your element with delegate-handle="'+handle+'" is a child of your controller, then your element may not be compiled yet. Put a $timeout around your call to '+methodName+"() and try again."):returnValue}}return methodNames.forEach(function(methodName){DelegateInstance.prototype[methodName]=instanceMethodCaller(methodName)}),DelegateService.prototype=DelegateInstance.prototype,DelegateService.prototype._registerInstance=function(instance,handle,filterFn){var instances=this._instances;return instance.$$delegateHandle=handle,instance.$$filterFn=filterFn||trueFn,instances.push(instance),function(){var index=instances.indexOf(instance);-1!==index&&instances.splice(index,1)}},DelegateService.prototype.$getByHandle=function(handle){return new DelegateInstance(this._instances,handle)},new DelegateService}]}}(window.base)}(),youtubePlayerModule.controller("youtubeVideo",["$scope","youtubeApi","$attrs","$youtubePlayerDelegate",function($scope,youtubeApi,$attrs,$youtubePlayerDelegate){this.player=null,this.element=null;var playerReady=!1,self=this,deregisterInstance=$youtubePlayerDelegate._registerInstance(self,$attrs.delegateHandle);$scope.$on("$destroy",function(){deregisterInstance()}),this.init=function(){youtubeApi.youTubeIframeAPIReady().then(function(){self.valid()&&self.cueVideo()},function(){$scope.onApiLoadingFailure({controller:self})})},this.reload=function(){this.init()},this.setPlayerElement=function(element){this.element=element},this.getPlayer=function(){return this.player||(this.player=new YT.Player(this.element,{playerVars:$scope.playerVars||{},height:$scope.height||"390",width:$scope.width||"640",events:getPlayerEvents()})),this.player},this.cueVideo=function(){var player=this.getPlayer();if(playerReady){var context=$scope.videoId?"id":"url",videoParameters=$scope.videoParameters||{};switch(context){case"id":videoParameters.videoId=$scope.videoId,player.cueVideoById(videoParameters);break;case"url":videoParameters.mediaContentUrl=$scope.mediaContentUrl,player.cueVideoByUrl(videoParameters)}}},this.valid=function(){return this.element&&($scope.videoId||$scope.mediaContentUrl&&$scope.mediaContentUrl.match(/^http(s)?:\/\/(www.)?youtube/))};var getPlayerEvents=function(){return{onReady:function(event){$scope.onReady({event:event}),playerReady=!0,self.cueVideo()},onStateChange:function(event){$scope.onStateChange({event:event})},onPlaybackQualityChange:function(event){$scope.onPlaybackQualityChange({event:event})},onPlaybackRateChange:function(event){$scope.onPlaybackRateChange({event:event})},onError:function(event){$scope.onError({event:event})},onApiChange:function(event){$scope.onApiChange({event:event})}}}}]),youtubePlayerModule.directive("youtubeVideo",function(){return{restrict:"AE",scope:{height:"@",width:"@",videoId:"@",mediaContentUrl:"@",playerVars:"=?",videoParameters:"=?",onReady:"&?",onStateChange:"&?",onPlaybackQualityChange:"&?",onPlaybackRateChange:"&?",onError:"&?",onApiChange:"&?",onControllerReady:"&?",onApiLoadingFailure:"&?"},template:"<div></div>",controller:"youtubeVideo",link:function($scope,element,attrs,ctrl){$scope.onControllerReady({controller:ctrl}),ctrl.setPlayerElement(element.children()[0]),ctrl.init(),$scope.$watch("height + width",function(newValue,oldValue){newValue!==oldValue&&ctrl.valid()&&ctrl.getPlayer().setSize($scope.width,$scope.height)}),$scope.$watch("[videoId,mediaContentUrl]",function(newValue,oldValue){newValue[0]&&oldValue[0]===newValue[0]||angular.equals(oldValue,newValue)||!ctrl.valid()||ctrl.cueVideo()}),$scope.$watch("videoParameters",function(newValue,oldValue){!angular.equals(oldValue,newValue)&&ctrl.valid()&&ctrl.cueVideo()},!0)}}}),youtubePlayerModule.service("$youtubePlayerDelegate",base.DelegateService(["getPlayer"])),youtubePlayerModule.service("youtubeApi",["$window","$q","$timeout",function($window,$q,$timeout){var iframeAPILoadingDeferred=null;this.youTubeIframeAPIReady=function(timeout){if(!iframeAPILoadingDeferred){iframeAPILoadingDeferred=$q.defer();var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var resolved=!1;$window.onYouTubeIframeAPIReady=function(){resolved=!0,iframeAPILoadingDeferred.resolve()},$timeout(function(){resolved||(iframeAPILoadingDeferred.reject("Could not load youtube iframe API"),iframeAPILoadingDeferred=null,tag.parentNode.removeChild(tag))},timeout||15e3)}return iframeAPILoadingDeferred.promise}}]);