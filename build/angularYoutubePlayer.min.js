var youtubePlayerModule=angular.module("youtubePlayer",[]);youtubePlayerModule.controller("youtubeVideo",["$scope","youtubeApi",function($scope,youtubeApi){this.player=null,this.element=null;var playerReady=!1,self=this;this.init=function(){youtubeApi.youTubeIframeAPIReady().then(function(){self.valid()&&self.cueVideo()},function(){$scope.onApiLoadingFailure({controller:self})})},this.reload=function(){this.init()},this.setPlayerElement=function(element){this.element=element},this.getPlayer=function(){return this.player||(this.player=new YT.Player(this.element,{playerVars:$scope.playerVars||{},height:$scope.height||"390",width:$scope.width||"640",events:getPlayerEvents()})),this.player},this.cueVideo=function(){var player=this.getPlayer();if(playerReady){var context=$scope.videoId?"id":"url",videoParameters=$scope.videoParameters||{};switch(context){case"id":videoParameters.videoId=$scope.videoId,player.cueVideoById(videoParameters);break;case"url":videoParameters.mediaContentUrl=$scope.mediaContentUrl,player.cueVideoByUrl(videoParameters)}}},this.valid=function(){return this.element&&($scope.videoId||$scope.mediaContentUrl&&$scope.mediaContentUrl.match(/^http(s)?:\/\/(www.)?youtube/))};var getPlayerEvents=function(){return{onReady:function(event){$scope.onReady({event:event}),playerReady=!0,self.cueVideo()},onStateChange:function(event){$scope.onStateChange({event:event})},onPlaybackQualityChange:function(event){$scope.onPlaybackQualityChange({event:event})},onPlaybackRateChange:function(event){$scope.onPlaybackRateChange({event:event})},onError:function(event){$scope.onError({event:event})},onApiChange:function(event){$scope.onApiChange({event:event})}}}}]),youtubePlayerModule.directive("youtubeVideo",function(){return{restrict:"AE",scope:{height:"@",width:"@",videoId:"@",mediaContentUrl:"@",playerVars:"=?",videoParameters:"=?",onReady:"&?",onStateChange:"&?",onPlaybackQualityChange:"&?",onPlaybackRateChange:"&?",onError:"&?",onApiChange:"&?",onControllerReady:"&?",onApiLoadingFailure:"&?"},template:"<div></div>",controller:"youtubeVideo",link:function($scope,element,attrs,ctrl){$scope.onControllerReady({controller:ctrl}),ctrl.setPlayerElement(element.children()[0]),ctrl.init(),$scope.$watch("height + width",function(newValue,oldValue){newValue!==oldValue&&ctrl.valid()&&ctrl.getPlayer().setSize($scope.width,$scope.height)}),$scope.$watch("[videoId,mediaContentUrl]",function(newValue,oldValue){newValue[0]&&oldValue[0]===newValue[0]||angular.equals(oldValue,newValue)||!ctrl.valid()||ctrl.cueVideo()}),$scope.$watch("videoParameters",function(newValue,oldValue){!angular.equals(oldValue,newValue)&&ctrl.valid()&&ctrl.cueVideo()},!0)}}}),youtubePlayerModule.service("youtubeApi",["$window","$q","$timeout",function($window,$q,$timeout){var iframeAPILoadingDeferred=null;this.youTubeIframeAPIReady=function(timeout){if(!iframeAPILoadingDeferred){iframeAPILoadingDeferred=$q.defer();var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var resolved=!1;$window.onYouTubeIframeAPIReady=function(){resolved=!0,iframeAPILoadingDeferred.resolve()},$timeout(function(){resolved||(iframeAPILoadingDeferred.reject("Could not load youtube iframe API"),iframeAPILoadingDeferred=null,tag.parentNode.removeChild(tag))},timeout||15e3)}return iframeAPILoadingDeferred.promise}}]);